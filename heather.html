<!DOCTYPE html>
<html lang="da">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@600&family=Nunito:wght@700&display=swap" rel="stylesheet">
    <style>
        .cute-formal {
            font-family: 'Quicksand', 'Nunito', Arial, sans-serif;
            font-size: 2.1rem;
            text-align: center;
            margin-top: 32px;
            margin-bottom: 24px;
            letter-spacing: 1px;
        }
        .danish-red {
            color: #d72828;
            text-shadow: 1px 1px 8px #fff, 0 0 2px #d72828;
        }
        .danish-white {
            color: #fff;
            text-shadow: 1px 1px 8px #d72828, 0 0 2px #fff;
        }
    </style>
</head>
<body>
    <div class="cute-formal">
        <span class="danish-red">Velkommen til Danmark</span><br>
        <span class="danish-white">og lad os lÃ¦re dansk sammen!</span>
    </div>

    <div id="danish-catalog" style="margin: 32px auto 24px auto; max-width: 600px; background: rgba(255,255,255,0.92); border-radius: 16px; box-shadow: 0 2px 12px rgba(215,40,40,0.08); padding: 24px;">
        <h2 style="color:#d72828; font-family:'Quicksand','Nunito',Arial,sans-serif; text-align:center;">Dansk Samtale Katalog ðŸ‡©ðŸ‡°</h2>
        <ul style="font-size:1.1rem; line-height:1.7;">
            <li><a href="#a1-convo">A1: Hilsner og prÃ¦sentationer</a></li>
            <li><a href="#a2-convo">A2: Hverdagsliv</a></li>
            <li><a href="#b1-convo">B1: Rejser og oplevelser</a></li>
            <li><a href="#b2-convo">B2: Arbejde og studier</a></li>
            <li><a href="#c1-convo">C1: Samfund og debat</a></li>
            <li><a href="#c2-convo">C2: Avanceret diskussion</a></li>
        </ul>
        <hr style="margin:18px 0;">
        <h3 style="color:#d72828;">Vocabularium</h3>
        <ul style="font-size:1.05rem;">
            <li><a href="#vocab-greetings">Hilsner</a></li>
            <li><a href="#vocab-travel">Rejseord</a></li>
            <li><a href="#vocab-daily">Dagligdags udtryk</a></li>
            <li><a href="#vocab-work">Arbejde</a></li>
            <li><a href="#vocab-advanced">Avanceret ordforrÃ¥d</a></li>
        </ul>
    </div>

    <div id="profile-section" style="margin-bottom:16px; text-align:center;">
        <img id="profile-pic" src="https://api.dicebear.com/7.x/bottts/svg?seed=danish" alt="Avatar" style="width:60px; height:60px; border-radius:50%; border:2px solid #d72828; object-fit:cover;">
        <br>
        <input type="file" id="upload-pic" accept="image/*" style="display:none;">
        <button onclick="document.getElementById('upload-pic').click()" style="margin-top:6px;">Upload billede</button>
        <button onclick="chooseAvatar()" style="margin-top:6px;">VÃ¦lg avatar</button>
    </div>

    <!-- Chat Room Start -->
    <div id="chat-room" style="
        border:1px solid #ccc;
        padding:16px;
        width:350px;
        margin-top:30px;
        border-radius: 16px;
        background: url('https://images.unsplash.com/photo-1506744038136-46273834b3fb?auto=format&fit=crop&w=600&q=80') center/cover no-repeat, linear-gradient(135deg, #fff8 60%, #d7282888 100%);
        box-shadow: 0 4px 24px rgba(215,40,40,0.08);
        ">
        <h2 style="color:#d72828; text-shadow: 1px 1px 6px #fff;">Chatrum ðŸ‡©ðŸ‡°</h2>
        <div id="chat-messages" style="height:150px; overflow-y:auto; border:1px solid #eee; padding:8px; background:rgba(255,255,255,0.85); margin-bottom:10px; border-radius:8px;"></div>
        <input type="text" id="chat-input" placeholder="Skriv en besked..." style="width:75%; border-radius:6px; border:1px solid #ccc; padding:4px;">
        <button onclick="sendMessage()" style="background:#d72828; color:#fff; border:none; border-radius:6px; padding:6px 12px; margin-left:4px;">Send</button>
    </div>
    <!-- Chat Room End -->

    <script>
        const chatMessages = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        const profilePic = document.getElementById('profile-pic');
        const uploadPic = document.getElementById('upload-pic');

        // Load saved avatar
        if(localStorage.getItem('profilePic')) {
            profilePic.src = localStorage.getItem('profilePic');
        }

        uploadPic.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(evt) {
                profilePic.src = evt.target.result;
                localStorage.setItem('profilePic', evt.target.result);
            };
            reader.readAsDataURL(file);
        });

        function chooseAvatar() {
            // Use DiceBear for random cute avatars
            const seed = Math.random().toString(36).substring(2, 10);
            const url = `https://api.dicebear.com/7.x/bottts/svg?seed=${seed}`;
            profilePic.src = url;
            localStorage.setItem('profilePic', url);
        }

        function loadChatHistory() {
            const history = JSON.parse(localStorage.getItem('chatHistory') || '[]');
            chatMessages.innerHTML = '';
            history.forEach((msgObj, idx) => {
                const msgDiv = document.createElement('div');
                msgDiv.style.marginBottom = '10px';

                // Main message
                const p = document.createElement('p');
                p.textContent = `${msgObj.user}: ${msgObj.text}`;
                p.style.margin = '0';

                // Translation
                const t = document.createElement('div');
                t.textContent = `OversÃ¦ttelse: ${msgObj.translation}`;
                t.style.fontSize = '0.95em';
                t.style.color = '#555';
                t.style.marginLeft = '12px';

                msgDiv.appendChild(p);
                msgDiv.appendChild(t);

                // Add edit/recall buttons to the last message
                if (idx === history.length - 1) {
                    const editBtn = document.createElement('button');
                    editBtn.textContent = 'Rediger';
                    editBtn.style.marginLeft = '8px';
                    editBtn.onclick = function() { editLastMessage(); };

                    const recallBtn = document.createElement('button');
                    recallBtn.textContent = 'Recall';
                    recallBtn.style.marginLeft = '4px';
                    recallBtn.onclick = function() { recallLastMessage(); };

                    msgDiv.appendChild(editBtn);
                    msgDiv.appendChild(recallBtn);
                }

                chatMessages.appendChild(msgDiv);
            });
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function saveMessage(msg) {
            const history = JSON.parse(localStorage.getItem('chatHistory') || '[]');
            history.push(msg);
            localStorage.setItem('chatHistory', JSON.stringify(history));
        }

        function updateLastMessage(newMsg) {
            const history = JSON.parse(localStorage.getItem('chatHistory') || '[]');
            if (history.length > 0) {
                history[history.length - 1] = newMsg;
                localStorage.setItem('chatHistory', JSON.stringify(history));
            }
        }

        async function translateMessage(text, targetLang = 'en') {
            // You can change 'en' to any supported language code, e.g., 'da' for Danish, 'de' for German, etc.
            const res = await fetch('https://libretranslate.de/translate', {
                method: 'POST',
                body: JSON.stringify({
                    q: text,
                    source: 'auto',
                    target: targetLang,
                    format: 'text'
                }),
                headers: { 'Content-Type': 'application/json' }
            });
            const data = await res.json();
            return data.translatedText;
        }

        async function sendMessage() {
            const msg = chatInput.value.trim();
            if (msg) {
                // User message
                const fullMsg = { user: "Du", text: msg, translation: "" };
                saveMessage(fullMsg);
                loadChatHistory();
                chatInput.value = '';

                // Translate the message and display it
                const translated = await translateMessage(msg, 'en');
                fullMsg.translation = translated;
                updateLastMessage(fullMsg);
                loadChatHistory();

                // Bot reply (simulate bot only if not empty and not a command)
                if (msg.length > 0) {
                    // Call Monkedev API for bot reply
                    try {
                        const res = await fetch(`https://api.monkedev.com/fun/chat?msg=${encodeURIComponent(msg)}&uid=danishuser`);
                        const data = await res.json();
                        const botMsg = { user: "Bot", text: data.response, translation: await translateMessage(data.response, 'da') };
                        saveMessage(botMsg);
                        loadChatHistory();
                    } catch (error) {
                        console.error("Error fetching bot reply:", error);
                    }
                }
            }
        }

        function editLastMessage() {
            const history = JSON.parse(localStorage.getItem('chatHistory') || '[]');
            if (history.length > 0) {
                // Remove "Du: " prefix for editing
                let lastMsg = history[history.length - 1];
                chatInput.value = lastMsg.text;
                chatInput.focus();
                // Remove last message so it will be replaced on send
                history.pop();
                localStorage.setItem('chatHistory', JSON.stringify(history));
                loadChatHistory();
            }
        }

        function recallLastMessage() {
            const history = JSON.parse(localStorage.getItem('chatHistory') || '[]');
            if (history.length > 0) {
                history.pop();
                localStorage.setItem('chatHistory', JSON.stringify(history));
                loadChatHistory();
            }
        }

        chatInput.addEventListener('keydown', function(e) {
            if (e.key === 'Enter') sendMessage();
        });

        loadChatHistory();
    </script>
</body>
</html>